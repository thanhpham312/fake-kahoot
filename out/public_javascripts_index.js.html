<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: public/javascripts/index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: public/javascripts/index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// Page elements:
let questionViewWrap = document.getElementById('questionViewWrap')
let userInfo = document.getElementById('userInfo')
let questionNumber = document.getElementById('questionNumber')
let questionContent = document.getElementById('questionContent')
let greetBox = document.getElementById('greetBox')
let answer1 = document.getElementById('answer1')
let answer2 = document.getElementById('answer2')
let answer3 = document.getElementById('answer3')
let answer4 = document.getElementById('answer4')
let userName = document.getElementById('greetBoxUsernameInput')
let greetBoxPlayAsGuestButton = document.getElementById('greetBoxPlayAsGuestButton')
let greetBoxPlayButton = document.getElementById('greetBoxPlayButton')
let popupWrap = document.getElementById('popupWrap')
let popupMessageUsername = document.getElementById('popupMessageUsername')
let popupMessageScore = document.getElementById('popupMessageScore')
let popupMessageStreak = document.getElementById('popupMessageStreak')
let notification = document.getElementById('notify')
let notifyTitle = document.getElementById('notify_title')
let notifyWrap = document.getElementById('wrap')
let questionType = document.getElementById('trivia_category')
let questionDiff = document.getElementById('trivia_difficulty')

let currentQuestion = {}
let userObject = {}

let InitialScript = () => {
  checkLoginStatus((status) => {
    if (status === true) {
      userName.style.display = 'none'
      greetBoxPlayAsGuestButton.style.display = 'none'
      greetBoxPlayButton.style.display = 'inline-block'
    } else {
      userName.style.display = 'inline-block'
      greetBoxPlayAsGuestButton.style.display = 'inline-block'
      greetBoxPlayButton.style.display = 'none'
    }
  })
}

let assessQuestionResult = (chosenAnswer) => {
  serverRequest('POST', '/validateanswer', `chosenAnswer=${chosenAnswer}`, (xmlhttp) => {
    if (xmlhttp.readyState === 4 &amp;&amp; xmlhttp.status === 200) {
      let xmlhttpResult = JSON.parse(xmlhttp.responseText)
      userObject = xmlhttpResult.currentUser
      if (xmlhttpResult.result === true) {
        displayNotification('right')
      } else {
        displayNotification('wrong')
      }
      populatePopupResult()
    }
  })
}

let storeQuizResult = () => {
  questionViewWrap.style.top = '-100vh'
  serverRequest('POST', '/storeuser', '', (xmlhttp) => {
    if (xmlhttp.readyState === 4 &amp;&amp; xmlhttp.status === 201) {
      swal('Success', 'Your score has been saved!', 'success')
    } else {
      swal('Error', 'Unknown error!', 'error')
    }
  })
  notifyWrap.style.display = 'block'
  notification.style.right = '0'
  setTimeout(() => {
    notification.style.right = '-100%'
    popupWrap.style.top = '50vh'
    setTimeout(() => {
      notifyWrap.style.display = 'none'
    }, 300)
  }, 1200)
}

let play = () => {
  checkLoginStatus((status) => {
    if (status) {
      if (questionType.options[questionType.selectedIndex].value !== '-1' &amp;&amp; questionDiff.options[questionDiff.selectedIndex].value !== '-1') {
        serverRequest('POST', '/play', '', (xmlhttp) => {
          if (xmlhttp.readyState === 4 &amp;&amp; xmlhttp.status === 200) {
            userObject = JSON.parse(xmlhttp.responseText)
            notifyTitle.innerHTML = `Welcome ${userObject.username}`
            document.getElementById('tooltip').style.backgroundImage = 'url(/assets/images/icons/puzzle.svg)'
            userObject = JSON.parse(xmlhttp.responseText)
            startTrivia()
          }
        })
      } else {
        swal('Error!', 'Please fill out everything!', 'warning')
      }
    } else {
      // swal('Error!', 'Unexpected request!\nPlease reload the page', 'warning')
    }
  })
}

/**
 *
 * @param {number} - ????
 */
let playAsGuest = (event = 1) => {
  checkLoginStatus((status) => {
    if (!status) {
      if (event === 1 || event.keyCode === 13) {
        if (userName.value !== '' &amp;&amp; questionType.options[questionType.selectedIndex].value !== '-1' &amp;&amp; questionDiff.options[questionDiff.selectedIndex].value !== '-1') {
          serverRequest('POST', '/playAsGuest', `username=${userName.value}`, (xmlhttp) => {
            if (xmlhttp.readyState === 4 &amp;&amp; xmlhttp.status === 200) {
              userObject = JSON.parse(xmlhttp.responseText)
              notifyTitle.innerHTML = `Welcome ${userObject.username}`
              document.getElementById('tooltip').style.backgroundImage = 'url(/assets/images/icons/puzzle.svg)'
              userObject = JSON.parse(xmlhttp.responseText)
              startTrivia()
            }
          })
        } else {
          swal('Error!', 'Please fill out everything!', 'warning')
        }
      }
    } else {
      swal('Error!', 'Unexpected request!\nPlease reload the page', 'warning')
    }
  })
}

/**
 * @desc Displays the current user's name to the popup message Username along with their current Score and Highest Streak
 *
 */
let populatePopupResult = () => {
  popupMessageUsername.innerHTML = userObject.username
  popupMessageScore.innerHTML = `SCORE: ${userObject.currentScore.userScore}`
  popupMessageStreak.innerHTML = `HIGHEST STREAK: ${userObject.currentScore.highestStreak}`
}
/**
 * @desc function displays the next question or the result when the game is over
 */
let getNextQuestion = () => {
  serverRequest('POST', '/getnextquestion', '', (xmlhttp) => {
    if (xmlhttp.readyState === 4 &amp;&amp; xmlhttp.status === 200) {
      currentQuestion = JSON.parse(xmlhttp.responseText)
      displayQuestion()
      startMyTimer()
      greetBox.style.opacity = '0'
      setTimeout(() => {
        greetBox.style.display = 'none'
      }, 300)
    } else if (xmlhttp.readyState === 4 &amp;&amp; xmlhttp.status === 204) {
      storeQuizResult()
    }
  })
}

/**
 * @desc Opens new HTTP request and looks for POST "/getquestions", if there is a state change, then it will parse into a JSON object which is displayed back to the user in the greet Box which only shows for 0.3 seconds then dissapears. Send quiz category and difficulty value to back end.
 */
let startTrivia = () => {
  serverRequest('POST', '/starttrivia', `chosenType=${questionType.options[questionType.selectedIndex].value}&amp;chosenDiff=${questionDiff.options[questionDiff.selectedIndex].value}`, (xmlhttp) => {
    if (xmlhttp.readyState === 4 &amp;&amp; xmlhttp.status === 200) {
      currentQuestion = JSON.parse(xmlhttp.responseText)
      displayQuestion()
      greetBox.style.opacity = '0'
      setTimeout(() => {
        greetBox.style.display = 'none'
      }, 300)
    }
  })
}

/**
 * @desc Displays a game question
 */
let displayQuestion = () => {
  notifyWrap.style.display = 'block'
  questionViewWrap.style.top = '-100vh'
  setTimeout(() => {
    notification.style.right = '0'
  }, 1)
  setTimeout(() => {
    userInfo.innerHTML = `${userObject.username} - ${userObject.currentScore.userScore}`
    questionNumber.innerHTML = 'QUESTION ' + (currentQuestion.index + 1)
    questionContent.innerHTML = currentQuestion.question
    answer1.innerHTML = currentQuestion.option1
    answer2.innerHTML = currentQuestion.option2
    answer3.innerHTML = currentQuestion.option3
    answer4.innerHTML = currentQuestion.option4
    questionViewWrap.style.top = '45vh'
    notification.style.right = '-100%'
    setTimeout(() => {
      notifyWrap.style.display = 'none'
    }, 300)
    startMyTimer()
  }, 1200)
}

/**
 * @desc Displays a pop up notifying if the answer was right or wrong
 * @param {string} mode - refers to user answer right/wrong
 */
let displayNotification = (mode) => {
  let thumbUp = 'url(/assets/images/icons/thumb-up.svg)'
  let thumbDown = 'url(/assets/images/icons/dislike.svg)'

  if (mode === 'wrong') {
    notifyTitle.innerHTML = 'Wrong! :('
    document.getElementById('tooltip').style.backgroundImage = thumbDown
  } else if (mode === 'right') {
    notifyTitle.innerHTML = 'Good Job! :)'
    document.getElementById('tooltip').style.backgroundImage = thumbUp
  }
}

InitialScript()
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Questions.html">Questions</a></li><li><a href="Score.html">Score</a></li><li><a href="User.html">User</a></li><li><a href="Users.html">Users</a></li><li><a href="%257Bstring%257D%2520this.fileName.html">fileName</a></li></ul><h3>Global</h3><ul><li><a href="global.html#displayNotification">displayNotification</a></li><li><a href="global.html#displayQuestion">displayQuestion</a></li><li><a href="global.html#getNextQuestion">getNextQuestion</a></li><li><a href="global.html#getQuestionByCategory">getQuestionByCategory</a></li><li><a href="global.html#getQuestions">getQuestions</a></li><li><a href="global.html#getQuestionsNewApi">getQuestionsNewApi</a></li><li><a href="global.html#playAsGuest">playAsGuest</a></li><li><a href="global.html#populatePopupResult">populatePopupResult</a></li><li><a href="global.html#request">request</a></li><li><a href="global.html#startTrivia">startTrivia</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun May 13 2018 19:39:02 GMT-0700 (PDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
